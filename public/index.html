<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#111827" />
    <title>Couple Calendar</title>
    <meta name="description" content="Couple Calendar - configure and login to continue" />
    <link rel="icon" href="/favicon.ico" />
    <style>
      /* Minimal inline styles to keep a pleasant fallback while React loads */
      body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:#f3f4f6; color:#111827; margin:0; }
      #pwa-install-btn{ display:none; position:fixed; right:1rem; bottom:1rem; background:#111827; color:#f4b135; border-radius:999px; padding:0.6rem 1rem; border:2px solid #f4b135; cursor:pointer; z-index:9999 }
    </style>
  </head>
  <body>
    <div id="root">
      <!-- React will mount here -->
      <noscript>Please enable JavaScript to run this app.</noscript>
    </div>

    <button id="pwa-install-btn" aria-hidden="true">Instalar app</button>

    <script>
      // Register service worker (safe no-op if handled inside the SPA)
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/service-worker.js')
          .then(()=>{console.log('SW registered');})
          .catch(()=>{console.log('SW register failed');});
      }

      // beforeinstallprompt flow (for Chrome/Edge)
      let deferredPrompt;
      const installBtn = document.getElementById('pwa-install-btn');

      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        if (installBtn) {
          installBtn.style.display = 'inline-block';
          installBtn.setAttribute('aria-hidden', 'false');
        }
      });

      if (installBtn) {
        installBtn.addEventListener('click', async () => {
          if (!deferredPrompt) return;
          deferredPrompt.prompt();
          const choiceResult = await deferredPrompt.userChoice;
          console.log('User choice', choiceResult);
          deferredPrompt = null;
          installBtn.style.display = 'none';
        });
      }

      window.addEventListener('appinstalled', () => {
        if (installBtn) installBtn.style.display = 'none';
        console.log('PWA was installed');
      });
    </script>

    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
