<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Configuração Inicial - Calendário de Casal</title>
    <style>
      body { font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial; background:#f9fafb; color:#111827; display:flex; align-items:center; justify-content:center; min-height:100vh; margin:0; padding:1rem; }
      .card { background:white; padding:1.25rem; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06); width:100%; max-width:720px; }
      label { display:block; margin-top:0.5rem; font-weight:600; }
      input { width:100%; padding:0.5rem; margin-top:0.25rem; border:1px solid #e5e7eb; border-radius:6px; }
      .row { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
      .actions { margin-top:1rem; display:flex; gap:0.5rem; }
      button { background:#111827; color:white; padding:0.5rem 1rem; border-radius:6px; border:none; cursor:pointer; }
      .muted { color:#6b7280; }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>Configuração Inicial</h2>
      <p class="muted">Cadastre os dois parceiros (nome + PIN). PIN mínimo 4 caracteres.</p>

      <form id="setupForm">
        <div class="row">
          <div>
            <label>Nome Parceiro 1</label>
            <input id="p1name" required />
            <label>PIN Parceiro 1</label>
            <input id="p1pin" required type="password" />
          </div>

          <div>
            <label>Nome Parceiro 2</label>
            <input id="p2name" required />
            <label>PIN Parceiro 2</label>
            <input id="p2pin" required type="password" />
          </div>
        </div>

        <div class="actions">
          <button type="submit">Criar</button>
          <button type="button" id="checkApp">Verificar App</button>
        </div>

        <p id="msg" class="muted" style="margin-top:0.5rem;"></p>
      </form>
    </div>

    <script>
      const form = document.getElementById('setupForm');
      const msg = document.getElementById('msg');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        msg.textContent = 'Enviando...';
        const body = {
          partner1Name: document.getElementById('p1name').value.trim(),
          partner1Pin: document.getElementById('p1pin').value,
          partner2Name: document.getElementById('p2name').value.trim(),
          partner2Pin: document.getElementById('p2pin').value
        };
        try {
          const res = await fetch('/api/setup', {
            method: 'POST',
            headers: { 'content-type': 'application/json' },
            body: JSON.stringify(body)
          });
          if (res.ok) {
            msg.textContent = 'Configuração criada com sucesso! Redirecionando...';
            setTimeout(() => { window.location.href = '/'; }, 1000);
          } else {
            const json = await res.json();
            msg.textContent = json?.error || 'Erro';
          }
        } catch (err) {
          msg.textContent = 'Erro de conexão';
        }
      });

      document.getElementById('checkApp').addEventListener('click', () => {
        window.location.href = '/';
      });
    </script>
  </body>
</html>